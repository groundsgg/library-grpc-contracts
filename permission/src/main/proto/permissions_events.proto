syntax = "proto3";

package gg.grounds.grpc.permissions;

option java_multiple_files = true;
option java_package = "gg.grounds.grpc.permissions";
option java_outer_classname = "PermissionsEventsProto";

import "google/protobuf/timestamp.proto";

service PermissionsEventsService {
  rpc SubscribePermissionsChanges (SubscribePermissionsChangesRequest)
      returns (stream PermissionsChangeEvent);
}

message SubscribePermissionsChangesRequest {
  string server_id = 1;
  string last_event_id = 2;
}

message PermissionsChangeEvent {
  string event_id = 1;
  string player_id = 2;
  google.protobuf.Timestamp occurred_at = 3;
  string reason = 4;
  repeated PermissionDelta direct_permission_deltas = 5;
  repeated GroupMembershipDelta group_membership_deltas = 6;
  repeated EffectivePermissionDelta effective_permission_deltas = 7;
  bool requires_full_refresh = 8;
}

message PermissionDelta {
  enum Action {
    ACTION_UNSPECIFIED = 0;
    ADD = 1;
    REMOVE = 2;
  }

  Action action = 1;
  string permission = 2;
  google.protobuf.Timestamp expires_at = 3;
}

message GroupMembershipDelta {
  enum Action {
    ACTION_UNSPECIFIED = 0;
    ADD = 1;
    REMOVE = 2;
  }

  Action action = 1;
  string group_name = 2;
  google.protobuf.Timestamp expires_at = 3;
}

message EffectivePermissionDelta {
  enum Action {
    ACTION_UNSPECIFIED = 0;
    ADD = 1;
    REMOVE = 2;
  }

  Action action = 1;
  string permission = 2;
}
